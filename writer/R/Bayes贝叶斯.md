
---
#### 基础理论
##### 贝叶斯定理

$P(A|B) = \frac{P(A \bigcap B)}{P(B)} = \frac{P(B|A) \cdot P(A)}{P(B)}$

##### 全概率公式

$P(B) = P(B|A) \cdot P(A) + P(B|\overline A) \cdot P(\overline A)$


#### 速算公式 (for朴素贝叶斯分类器)

$
P(A|B_1 B_2 B_3) = \frac{ \frac{P(A)}{P(\overline A)} \cdot \frac{P(B_1|A)}{P(B_1|\overline A)} \cdot \frac{P(B_2|A)}{P(B_2|\overline A)} \times \cdots }{ \frac{P(A)}{P(\overline A)} \cdot \frac{P(B_1|A)}{P(B_1|\overline A)} \cdot \frac{P(B_2|A)}{P(B_2|\overline A)} \times \cdots  + 1}
$

可见，要P(B|A)跟两个概率有关，一个是==先验概率P(A)==，一个是==似然概率P(B|A)==

1. P(A) -> 先验概率（基础概率）
- 无任何条件限制时事件A发生的概率

2. P(B|A) -> 似然概率（自己起得名，别人叫**相似度likelihood**）
- 在朴素贝叶斯分类器中，因为假设事件B1, B2, ...都是相互独立的，因此它们似然比是可以连乘的
- 各似然比连乘：==物以类聚，人以群分==，如果我们把A与~A看作两类人， 那么似然比连乘就是==这两类人做各种事情的概率比==连乘，比如A类人很可能去做B1，而~A类人很可能不去做B1； 而~A类人很愿意去做B2，恰恰A类人并不喜欢去做B2....==这两类人针对同一件事情会有不同的看法和倾向==
- 速算公式：==先验比 x 似然比1 x 似然比2 x ...，然后normalize==
- [似然函数](https://en.wikipedia.org/wiki/Likelihood_function)
3. 贝叶斯计算中拥有一个巨大的共同点，那就是根据既有输入，在庞大数据库中寻找匹配程度最高的项
4. 贝叶斯基于已知事件来强化对未知事件的信心程度，即当你获知了一个新的信息后，你对原事件的看法有什么改变
5. 如果事件E和事件F独立，那么F就不能影响E，于是P(E|F)=P(E)。把P(E|F)展开，就成了P(E∩F)/P(F)=P(E)，也即P(E∩F)=P(E)*P(F)。这不就是“两个独立事件同时发生的概率”的计算公式么。

***

例如：一所学校里面有 60% 的男生，40% 的女生。男生总是穿长裤，女生则一半穿长裤一半穿裙子。假设你走在校园中，迎面走来一个穿长裤的学生（很不幸的是你高度近似，你只看得见他（她）穿的是否长裤，而无法确定他（她）的性别），你能够推断出他（她）是男生的概率是多大吗？

设男生事件为B，穿长裤事件为T，则男生P(B) = 0.6，P(~B) = 0.4， 那么：

1. 因为我们要推断看到学生是男生的概率有多大，因此先验概率就是P(B) = 0.6

2. 现象是什么？现象是你看到了前面走过来的人穿的是长裤，这分两种情况：一种是男生穿长裤，一种是女生穿长裤，因此P(T) = P(T, B) + P(T, ~B) = P(B) * P(T|B) + P(~B) * P(T|~B) = 0.6 * 1.0 + 0.4 * 0.5 = 0.8

3. 所以P(B|P) = 0.6*1.0 / 0.8 = 0.75

---
#### 速算法则

问题1： 一机器在良好状态生产合格产品几率是90%，在故障状态生产合格产品几率是30%，机器良好的概率是75%，若一日第一件产品是合格品，那么此日机器良好的概率是多少。 


1. 先验比，PPR = 0.75 : (1-0.75) = 3 : 1
2. 似然比(Likelihood Ratio)，LR = 0.9 : 0.3 = 3
3. 两者相乘，得后验比率 = 9 : 1，然后
4. 标准化（normalize），得后验概率 = 9 / (9+1) = 0.9


问题1.1：回到原题。若问，假设这个机器第一天不是生产了 1 个零件，而是生产了 3 个零件，而且 3 个都合格（零件合格的概率互相独立），那机器良好的概率是多少？

先验比 x 似然比 =  (0.75/0.25)*(0.9/0.3)^3 = 81/1

归一化结果为 81/(1+81) = 81/82 = 0.987


问题1.2：假设机器生产了 10 个零件，6 个合格，4 个不合格（各个零件的生产相互独立），机器良好的概率是多少？

先验比 x 合格似然比 x 不合格似然比 = (0.75/0.25) * (0.9/0.3)^6 * (0.1/0.7)^4 = 2187/2401

归一化结果为 2187/(2401+2187) = 2187/4588 = 0.477



问题2：某个医院早上收了六个门诊病人，如下表

|症状　　| 职业　　　|疾病   |
|---    |---      |---     |
|打喷嚏　| 护士　　　| 感冒  |
|打喷嚏　| 农夫　　　| 过敏  |
|头痛　　| 建筑工人　| 脑震荡 |
|头痛　　| 建筑工人　| 感冒  |
|打喷嚏　| 教师　　　| 感冒  |
|头痛　　| 教师　　　| 脑震荡 |

现在又来了第七个病人，是一个打喷嚏的建筑工人。请问他患上感冒的概率有多大？[[朴素贝叶斯分类器的应用]](http://www.ruanyifeng.com/blog/2013/12/naive_bayes_classifier.html)

普通人得感冒的概率为P(感冒) = 3/6 = 0.5，因此先验比 PPR = 0.5/(1-0.5) = 1

感冒的人分两种，打喷嚏的和不打喷嚏的，这两种人得感冒的概率分别是P(感冒|打喷嚏)=2/3，P(感冒|不打喷嚏)= 1/3，因此似然比 LR1 = (2/3)/(1/3) = 2

感冒的人分两种，建筑工人和非建筑工人，这两种人得感冒的概率分别是P(感冒|建筑工人)=1/2，P(感冒|非建筑工人)= 2/4，因此似然比 LR2 = (1/2)/(2/4) = 1

因此 PPR x LR1 x LR2 = 1x2x1 = 2

归一化结果得到P(感冒|打喷嚏x建筑工人) = 2/3 = 0.66


---
#### 先验概率（基础概率）

先验概率的大小会严重影响检测结果，很多时候会反直觉。先验概率数据不一定在每种情况下都存在，但是假如确实有这个数据你却不用，那么，你将毁于==基础概率谬误==，即忽略事前数据并因此作出错误决策。

下面展示贝叶斯定理在检测吸毒者时的应用。假设一个常规的检测结果的敏感度与可靠度均为99%，即吸毒者每次检测呈阳性（+）的概率为99%。而不吸毒者每次检测呈阴性（-）的概率为99%。从检测结果的概率来看，检测结果是比较准确的，但是贝叶斯定理卻可以揭示一个潜在的问题。假设某公司对全体雇员进行吸毒检测，已知0.5%的雇员吸毒。请问每位检测结果呈阳性的雇员吸毒的概率有多高？


令“D”为雇员吸毒事件，“N”为雇员不吸毒事件，“+”为检测呈阳性事件。可得
1. P(D)代表雇员吸毒的概率，不考虑其他情况，该值为0.005。因为公司的预先统计表明该公司的雇员中有0.5%的人吸食毒品，所以这个值就是D的先验概率。
2. P(N)代表雇员不吸毒的概率，显然，该值为0.995，也就是1-P(D)。
3. P(+|D)代表吸毒者阳性检出率，这是一个条件概率，由于阳性检测准确性是99%，因此该值为0.99。
4. P(+|N)代表不吸毒者阳性检出率，也就是出错检测的概率，该值为0.01，因为对于不吸毒者，其检测为阴性的概率P(-|N)为99%，因此，其被误检测成阳性的概率为1 - 0.99 = 0.01。
5. P(+)代表不考虑其他因素的影响的阳性检出率。该值为0.0149或者1.49%。我们可以通过全概率公式计算得到：


检测呈阳性的概率  = 吸毒者阳性检出率（0.5% x 99% = 0.495%) + 不吸毒者阳性检出率（99.5% x 1% = 0.995%) = 0.0149

即：

P(+)= P(+,D) + P(+,N) = P(D) x P(+|D) + P(N) x P(+|N)
= 0.5% x 99% + 99.5% x 1%
= 0.0149

根据上述描述，我们可以计算某人检测呈阳性时确实吸毒的条件概率

P(D|+)  = P(D) x P(+|D) / P(+)
= 0.5% x 99% / 0.0149
= 0.3322



1. 吸毒检测的准确率高达99%，直觉上我们会觉得如果一个人检测呈阳性了，他基本上就是已经在吸毒了，但贝叶斯定理告诉我们：如果某人检测呈阳性，其吸毒的概率只有大约33%，不吸毒的可能性比较大。==假阳性高，则检测的结果不可靠，这可能会反直觉==。
2. 贝叶斯定理计算的是条件概率，换句话说，在不知道任何条件之前对每个员工我们认为他吸毒的概率是0.5%，但在检测之后，对于检测结果呈阳性的员工而言，他吸毒的概率变成了33%，是未检测之前的66倍。其实==P(D)与P(D|+)都是描述同一件事情，只不过P(D|+)是在得到某些新证据后计算出的一个更加精确的概率==。在针对该员工的新一轮的验证计算中，P(D|+)将会替代原P(D)的角色参与计算，贝叶斯公式可以通过不断的增加新证据叠加应用，这就是该公式的牛B之处。

---
#### 参考文献

[怎样用非数学语言讲解贝叶斯定理（Bayes' theorem）](https://www.zhihu.com/question/19725590/answer/32177811#)

[概率论教你说谎：直觉思维的科学解释](http://www.matrix67.com/blog/archives/2517)

[贝叶斯推断及其互联网应用](http://www.ruanyifeng.com/blog/2011/08/bayesian_inference_part_one.html)

[数学之美番外篇：平凡而又神奇的贝叶斯方法](http://mindhacks.cn/2008/09/21/the-magical-bayesian-method/)

[简捷启发式](https://book.douban.com/subject/1599035/)

[How to Write a Spelling Corrector](http://norvig.com/spell-correct.html)

[贝叶斯定理](https://zh.wikipedia.org/zh/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%AE%9A%E7%90%86)
